\def\year{2020}\relax
%File: formatting-instruction.tex
\documentclass[letterpaper]{article} % DO NOT CHANGE THIS
\usepackage{aaai20}  % DO NOT CHANGE THIS
\usepackage{times}  % DO NOT CHANGE THIS
\usepackage{helvet} % DO NOT CHANGE THIS
\usepackage{courier}  % DO NOT CHANGE THIS
\usepackage[hyphens]{url}  % DO NOT CHANGE THIS
\usepackage{graphicx} % DO NOT CHANGE THIS
\urlstyle{rm} % DO NOT CHANGE THIS
\def\UrlFont{\rm}  % DO NOT CHANGE THIS
\usepackage{graphicx}  % DO NOT CHANGE THIS
\frenchspacing  % DO NOT CHANGE THIS
\setlength{\pdfpagewidth}{8.5in}  % DO NOT CHANGE THIS
\setlength{\pdfpageheight}{11in}  % DO NOT CHANGE THIS

\usepackage{mathtools}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usepackage{algorithm,algorithmic}
%\nocopyright
%PDF Info Is REQUIRED.
% For /Author, add all authors within the parentheses, separated by commas. No accents or commands.
% For /Title, add Title in Mixed Case. No accents or commands. Retain the parentheses.
 \pdfinfo{
/Title (Learning Cooperative Solution Concepts from Data)
/Author (Wei Lu, Alan Tsang, Yair Zick)
/Keywords (Game Theory)
} %Leave this	
% /Title ()
% Put your actual complete title (no codes, scripts, shortcuts, or LaTeX commands) within the parentheses in mixed case
% Leave the space between \Title and the beginning parenthesis alone
% /Author ()
% Put your actual complete list of authors (no codes, scripts, shortcuts, or LaTeX commands) within the parentheses in mixed case. 
% Each author should be only by a comma. If the name contains accents, remove them. If there are any LaTeX commands, 
% remove them. 

% DISALLOWED PACKAGES
% \usepackage{authblk} -- This package is specifically forbidden
% \usepackage{balance} -- This package is specifically forbidden
% \usepackage{caption} -- This package is specifically forbidden
% \usepackage{color (if used in text)
% \usepackage{CJK} -- This package is specifically forbidden
% \usepackage{float} -- This package is specifically forbidden
% \usepackage{flushend} -- This package is specifically forbidden
% \usepackage{fontenc} -- This package is specifically forbidden
% \usepackage{fullpage} -- This package is specifically forbidden
% \usepackage{geometry} -- This package is specifically forbidden
% \usepackage{grffile} -- This package is specifically forbidden
% \usepackage{hyperref} -- This package is specifically forbidden
% \usepackage{navigator} -- This package is specifically forbidden
% (or any other package that embeds links such as navigator or hyperref)
% \indentfirst} -- This package is specifically forbidden
% \layout} -- This package is specifically forbidden
% \multicol} -- This package is specifically forbidden
% \nameref} -- This package is specifically forbidden
% \natbib} -- This package is specifically forbidden -- use the following workaround:
% \usepackage{savetrees} -- This package is specifically forbidden
% \usepackage{setspace} -- This package is specifically forbidden
% \usepackage{stfloats} -- This package is specifically forbidden
% \usepackage{tabu} -- This package is specifically forbidden
% \usepackage{titlesec} -- This package is specifically forbidden
% \usepackage{tocbibind} -- This package is specifically forbidden
% \usepackage{ulem} -- This package is specifically forbidden
% \usepackage{wrapfig} -- This package is specifically forbidden
% DISALLOWED COMMANDS
% \nocopyright -- Your paper will not be published if you use this command
% \addtolength -- This command may not be used
% \balance -- This command may not be used
% \baselinestretch -- Your paper will not be published if you use this command
% \clearpage -- No page breaks of any kind may be used for the final version of your paper
% \columnsep -- This command may not be used
% \newpage -- No page breaks of any kind may be used for the final version of your paper
% \pagebreak -- No page breaks of any kind may be used for the final version of your paperr
% \pagestyle -- This command may not be used
% \tiny -- This is not an acceptable font size.
% \vspace{- -- No negative value may be used in proximity of a caption, figure, table, section, subsection, subsubsection, or reference
% \vskip{- -- No negative value may be used to alter spacing above or below a caption, figure, table, section, subsection, subsubsection, or reference

\setcounter{secnumdepth}{0} %May be changed to 1 or 2 if section numbers are desired.

% The file aaai20.sty is the style file for AAAI Press 
% proceedings, working notes, and technical reports.
%
\setlength\titlebox{2.5in} % If your paper contains an overfull \vbox too high warning at the beginning of the document, use this
% command to correct it. You may not alter the value below 2.5 in
\title{Learning Cooperative Solution Concepts from Data}
%Your title must be in mixed case, not sentence case. 
% That means all verbs (including short verbs like be, is, using,and go), 
% nouns, adverbs, adjectives should be capitalized, including both words in hyphenated terms, while
% articles, conjunctions, and prepositions are lower case unless they
% directly follow a colon or long dash
\author{Wei Lu,\\
School of Computing\\
National University of Singapore\\
weilu@u.nus.edu
\And
Alan Tsang,\\
School of Computing\\
National University of Singapore\\
akhtsang@nus.edu.sg
\And
Yair Zick\\
School of Computing\\
National University of Singapore\\
dcsyaz@nus.edu.sg
}

 \begin{document}

\maketitle

\begin{abstract}
TODO
\end{abstract}

\noindent Introduction TODO

\section{Data}
Knesset is the national legislative branch of the Israeli government. Knesset website provides data access through Open Data Protocol (OData) on all its parliament members, laws, and every member's votes on every law. We limit our dataset to the 20th Knesset (2015-2019), which is the last Knesset preseeding the current one. We downloaded all 147 parliament members' information including id, name, faction id, faction name and their votes for all 7515 bills deliberated. A vote can take on one of the following values 0 (vote canceled), 1 (vote for), 2 (vote against), 3 (abstained), 4 (did not attend). We programmatically transformed the downloaded data into comma separated values (CSV), with each row representing a bill and each column representing a parliament member, so a cell value corresponds to the vote of a given parliament member for a given bill.

\subsection{Data Preprocessing}
During data processing, we noticed that more than half of all the vote values are missing despite the presence of value 4 for ``did not attend''. It raises questions regarding the data quality. We discovered another API endpoint which provides summary information for every bill, including total number of for votes, against votes, abstained votes, and if the bill is accepted. We downloaded bill summary data set for the 20th Knesset and used it to check against the tallied vote numbers from the individual vote data. We ended up discovering more inconsistencies:

\begin{itemize}
  \item Total bills checked: 7513,
  \item Missing bills in the summary dataset: 2,
  \item Number of bills with pass/reject status inconsistent: 26,
  \item Number of bills with for count inconsistent : 273,
  \item Number of bills with against count inconsistent : 402,
  \item Number of bills with abstain count inconsistent : 2
\end{itemize}

We reached out to Knesset regarding the data inconsistency between two API endpoints, as well as the missing value issue. The Knesset data management team stated that the inconsistency is likely a result of manual vote entries instead of votes recorded as a result of pressing the electronic button. Such manual vote entries are captured by the bill summary data set but not individual member's vote data set.

For the purpose of our research, we treat the data with individual member's votes on every bill as the ground truth since it has the level of granularity required for modeling.  We removed the 26 bills whose pass/reject status is inconsistent between the summary and invidual data sets, since it's most likely that the individual data is wrong. (coding TODO)

\section{Preliminaries}

\subsection{Hedonic Games}
Hedonic games are a sub-class of nontransferable utility cooperative games. A hedonic game is a coalition formation game with hedonic preferences. A coalition formation game aims to divide the set of all players $N$ into disjoint coalitions, formally known as a coalition structure, often denoted as $\pi$. Hedonic preferenfes means that every player only cares about the coalition they belong to, which implies that the inter-coalitional dependencies are completely ignored. The description of a hedonic game could be exponentially large in the number of players, as each player needs to rank all possible coalitions they may belong to.

\subsection{Top Responsive Games}
The intuition behind top responsiveness is that every player derives their utility from the most preferred subset players of the coalition they belong. If two coalitions, with one containing the other, yield the same utility for a player, the tie is broken in favor of the smaller coalition. Formally, for a game to satisfy top responsiveness, it requires the following three conditions to hold true for any player $i \in N$, and any coalition that may contain player $i$: $S, T \in \mathcal{N}_i$:
\begin{enumerate}
  \item $|Ch(i, S)| = 1$.
  \item if $ch(i, S) \succ_i ch(i, T)$ then $S \succ_i T$
  \item if $ch(i, S) = ch(i, T)$ and $S \subset T$ then $S \succ_i T$
\end{enumerate}

Where $Ch(i, S)$ denotes the choice sets of player $i$ in coalition $S$, formally defined as:

$Ch(i, S) = \{S' \subseteq S: (i \in S') \wedge (S' \succeq_i S'' \forall S'' \subseteq S)\}$

The unique choice set in $Ch(i, S)$ is denoted as $ch(i, S)$.

\subsection{Bottom Responsive Games}
Bottom responsive games can be viewed as the counterpart of top responsive games, where a player's utility is derived from the absence of disliked players. For a game to satisfy bottom responsiveness, two conditions are required:

\begin{enumerate}
  \item if for all $S' \in Av(i, S)$ $T' \in Av(i, T)$, $ S' \succ_i T'$ then $S \succ_i T$
  \item if $Av(i, S) \cap Av(i, T) \neq \emptyset$ and $|S| \geq |T|$ then $S \succeq_i T$
\end{enumerate}

Where $Av(i, S)$ denotes the avoid sets of player $i$ in coalition $S$, formally defined as:

$Av(i, S) = \{S' \subseteq S: (i \in S') \wedge (S' \preceq_i S'' \forall S'' \subseteq S)\}$

If in addition to the above two conditions, a game also satisfies $|Av(i, S)| = 1$ for all $i \in N$ and all $S \in \mathcal{N}_i$, then it is strongly bottom responsive.

\subsection{Mutuality}
Mutaulity in the context of top responsive games means that for all $i, j \in N$, for all coalition that contains $i$ and $j$: $S \in \mathcal{N}_i \cap \mathcal{N}_j$, $i \in ch(j, S)$ if and only if $j \in ch(i, S)$. Similarly, a strong bottom responsive game is mutual if $i \in av(j, S) \iff j \in av(i, S)$. Mutuality provides guarantees for solutions that satisfy stronger notion of stability, which we will discuss after the stability concepts defitions.

\subsection{Stability Concepts}
Core stable and strictly core stable are solution concepts useful for modeling real world scenarios because they represent a stable state where no subset of players can be better off by deviating from. A hedonic game solution $\pi$ is core stable when there is no strongly blocking coalition. A coalition $S \subseteq N$ strongly blocks a coalition structure $\pi$ if every player $i \in S$ strictly prefers $S$ over its current coalition $\pi(i)$. Similarly, a hedonic game is strictly core stable when there is no weakly blocking coalition. A coalition $S \subseteq N$ weakly blocks a coalition structure $\pi$ if every player $i \in S$ weakly prefers $S$ over its current coalition $\pi(i)$ and there exists at least one player $j \in S$ who strictly prefers $S$ over $\pi(j)$.

Strong Nash Stability (SNS) and Strict Strong Nash Stability (SSNS) is a pair of stronger stable concepts compared to Core (C) and Strict Core (SC) stabilities, that are also based on group deviations. If a partition $\pi' \neq \pi$ exists with movement of players $S \subseteq N$ and $S \neq \emptyset$ (denoted as $\pi \xrightarrow{S} \pi'$), where $\forall i \in S$, $\pi'(i) \succ_i \pi(i)$, and $\forall j \in N\text{\textbackslash}S$, $\pi'(j) = \pi(j)$, then $S$ strongly Nash blocks $\pi$. A partition that admits no strongly Nash blocking set $S \subseteq N$ is said to be strong Nash stable. A non-empty set of player $S \subseteq N$ weakly Nash blocks $\pi$ if $\forall i \in S$, $\pi'(i) \succeq_i \pi(i)$ and $\exists j \in S$, $\pi'(j) \succ_j \pi(j)$. A partition that admits no weakly Nash blocking set $S \subseteq N$ is said to be strict strong Nash stable.

Nash stable is the strongest stability notion based on individual deviations, as it doesn't account for the disutility of the group an individual player is joining or leaving. A partition is Nash stable if no player can benefit by moving unilaterally to another coalition.

TODO: Example of Core that's not SNS, example of SNS that's not strict core

\begin{figure}
\centering
\begin{tikzpicture}[
squarednode/.style={rectangle, draw=white!60, fill=white!5, very thick, minimum size=5mm},
]
%Nodes
\node[squarednode]      (SSNS)                             {SSNS};
\node[squarednode]      (SNS)       [below left=of SSNS]   {SNS};
\node[squarednode]      (NS)        [below=of SNS]         {NS};
\node[squarednode]      (SC)        [below right=of SSNS]  {SC};
\node[squarednode]      (C)         [below=of SC]          {C};

%Lines
\draw[->] (SSNS.south west) -- (SNS.north east);
\draw[->] (SNS.south) -- (NS.north);
\draw[->] (SSNS.south east) -- (SC.north west);
\draw[->] (SC.south) -- (C.north);
\draw[->] (SNS.south east) -- (C.north west);
\end{tikzpicture}
\caption{Relationships between stability concepts for hedonic games: Strict strong Nash stable implies strict core and strong Nash stable. Strong Nash stable immplies core and Nash stable. Strict core implies core.}
\end{figure}

\subsection{Algorithms and Their Complexities}

\cite{ALCALDE2004869} showed that top responsive games guarantee the existence of a core stable partition, which is discoverable through the Top Covering Algorithm. \cite{DIMITROV2007130} simplified the original Top Covering Algorithm and proved that it not only constructs a core, but a strict core. \cite{Dimitrov2006TopRA} also showed that adding the mutuality condition the simplified top covering algorithm produces a Nash stable partition. \cite{Aziz:2012:ESH:2343776.2343806} further proved that with mutuality the partition produced is in fact strict strong Nash stable for any top responsive game.

\begin{algorithm}[htb]
  \caption{Top Covering Algorithm}
  \label{alg:top_covering}
  \textbf{Input:} A hedonic game satisfying top responsiveness.

  \begin{algorithmic}[1]
\STATE $R^1 \leftarrow N$; $\pi \leftarrow \emptyset$.

\FOR{$k=1$ to $|N|$}
\STATE \label{step:select} Select $i\in R^k$ such that $|CC(i,R^k)| \leq |CC(j,R^k)|$ for each $j\in R^k$.
\STATE $S^k\leftarrow  CC(i,R^k)$; $\pi \leftarrow  \pi \cup \lbrace S^k \rbrace$;  and $R^{k+1} \leftarrow  R^k \setminus S^k$
 \IF{$R^{k+1} = \emptyset$}
\RETURN $\pi$
\ENDIF
\ENDFOR
\RETURN $\pi$
 \end{algorithmic}
\end{algorithm}

Where $CC(i, S)$ denotes the connected component with $i$ as the root node, in the graph induced by $S$ as vertices and directed edges $E$, $(i, j) \in E$ if $j \in ch(i, S)$ for all $j \in S$.

Note that the input of the top covering algorithm is the entire preference profile of all players, which is in the order of $O(2^{|N|})$. Finding the choice set for every player after each round of player removal at line 4 requires scanning through every remaining player's preference relation, which makes the most expensive part of this algorithm, so this algorithm is exponential time in the number of players.

Bottom Avoiding Algorithm

\subsection{PAC Learning and PAC Stability}
Probably Approximately Correct (PAC) learning is the canonical framework aimed at providing good probabilistic approximation to functions with polynormial number of samples. A good probabilistic approximation means that with high probability of at least $1 - \delta$, the selected function has low generalization error $\varepsilon$, where $0 < \varepsilon, \delta < 1$. A hypothesis class is efficiently PAC learnable if such a good probabilistic approximation can be produced by some algorithm that has both running time and input sample size be polynormial in $n$, $\frac{1}{\varepsilon}$, and $\log{\frac{1}{\delta}}$.

In the context of hedonic games, based on a similar notion \cite{ijcai2017-380} defined that a class of hedonic games is PAC stablizable if there exists a polynormial time and input size algorithm in $n$, $\frac{1}{\varepsilon}$, and $\log{\frac{1}{\delta}}$ that produces a partition $\pi$ such that $\Pr_{S\sim D}[\text{S core blocks } \pi] < \varepsilon$. In the same paper, \cite{ijcai2017-380} also showed that top responsive games are efficiently PAC stablizable despite not PAC learnable. The PAC stable partition can be computed with Algorithm ~\ref{alg:pac_top_covering}.

\begin{algorithm}[htb]
  \caption{PAC Top Covering Algorithm:TODO complete}
  \label{alg:pac_top_covering}
  \textbf{Input:} $\varepsilon$, $\delta$, set $S$ of $m = (2n^4 + 2n^3)\ceil{\frac{1}{\epsilon}\log{\frac{2n^3}{\delta}}}$ samples from D

  \begin{algorithmic}[1]
\STATE $R^1 \leftarrow N$; $\pi \leftarrow \emptyset$.

\FOR{$k=1$ to $|N|$}
\STATE Select $i\in R^k$ such that $|CC(i,R^k)| \leq |CC(j,R^k)|$ for each $j\in R^k$.
\STATE $S^k\leftarrow  CC(i,R^k)$; $\pi \leftarrow  \pi \cup \lbrace S^k \rbrace$;  and $R^{k+1} \leftarrow  R^k \setminus S^k$
 \IF{$R^{k+1} = \emptyset$}
\RETURN $\pi$
\ENDIF
\ENDFOR
\RETURN $\pi$
 \end{algorithmic}
\end{algorithm}

Where every sample consists of a coalition $S_j \subseteq N$, and the values assigned to $S_j$ by each of its member $\vec{v}(S_j) = (v_i(S_j))_{i \in S_j}$.

\section{Experiments}

\subsection{Top Responsive Game Model}
Top responsiveness models a preference profile where every player derives their utility for a given coalition from the most preferred subset players in their coalition. In the context of legislature, it captures that politicians care about whose votes they stand with – they want to vote with other politicians they like. Top responsiveness guarantees a core stable partition, which can be computed using Algorithm ~\ref{alg:top_covering} if the full preference profile is given. When the complete preference profile is not available, we can use Algorithm ~\ref{alg:pac_top_covering} to approximate a core stable partition. We then compare the resulting partitions to party affiliations to assess the quality of our models.

\subsection{Handcrafted Value Function}
For each bill there are two natural coalitions: one formed by parliament members who voted ``for'', and the other formed by parliament members who voted ``against''. Note that the values assigned by members to their respective coalitions are not immediately well defined, so we define the player $i$'s value function for coalition $S$ as below:

\[
  v_i(S) = 
  \begin{dcases}
      1 + \frac{1}{|S|} + \frac{|S_p|}{|N|},& \text{if S is the winning majority}\\
      0,              & \text{otherwise}
  \end{dcases}
\]

$S$ can take on one of the two values $\{S_f, S_a\}$, where $S_f$ is the set of members who voted ``for'' and $S_a$ is the set of members who voted ``against''. $S_p$ denotes the set of parliament members who participated $S_p = S_f \cup S_a$. $S_f$ is the winning majority if $|S_f| > |S_a|$, vice versa. When $|S_f| = |S_a|$, $S_a$ is considered to be the winning majority.

The conditional value function captures that a winning coalition, being successfully passing a bill or successfully blocking a bill, is always worth more than a losing coalition. $\frac{1}{|S|}$ reflects that a win is considered more valuable when it's achieved with fewer members, which is also conceptually consistent with top responsive game's preference for smaller coalitions. The partition term $\frac{|S_p|}{|N|}$ gives a win more value when more parliament members voted for or against the bill. For simplicity, we assume every member in a given coalition assigns equal value to their coalition.

This handcrafted value function allows us to construct a partial preference relation for every parliment member. We programmatically verified that this partial preference profile in fact does not satisfy top responsiveness. It makes this approach analogous to improper learning.

To simulate i.i.d, we item sample $\frac{3}{4}$ of the bills with replacement. We repeated the algorithm run 100 times and observed that the resulting partition is consistent with little variability. (TODO: double check identical partition across all 100 runs). It is not core stable with respect to the partial preference profile. This is unsurprising due to the PAC model. The partition has one large coalition consisting of 61 members and 86 singleton coalitions. All members of the only large coalition are from right wing parties. Despite the number of singleton coalitions, the largest coalition does reflect political position of about 40\% of the parliment members.

\bibliography{references}
\bibliographystyle{aaai}

\end{document}

